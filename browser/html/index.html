
<!DOCTYPE HTML>
<html>
    <head>
        <meta name="viewport" content="width=device-width, user-scalable=no">
        <meta charset="utf-8">
    </head>
<body style="padding:0px;margin:0;background: #2e6da3; overflow: hidden;">
<canvas id="canvas" style="background:#ccc;"></canvas>
<div id="game_pad" style="display: none; position: absolute; width: 100%; height: 131px; margin-bottom: 10px; left: 0px; bottom: 0px; border-radius: 25px;background: rgba(255, 255, 255, 0.1);">
    <div id="game_pad_direction" style="background: url(control.png); width:128px; height:128px; display: block; position: absolute; left: 5px; top: 2px;"></div>
    <div id="game_pad_button_a" style="background: url(button.png); width:48px; height:48px; display: block; position: absolute; right: 5px; top: 5px;"></div>
    <div id="game_pad_button_b" style="background: url(button.png); width:48px; height:48px; display: block; position: absolute; right: 60px; bottom: 5px;"></div>
</div>
<script src="game.js"></script>
<script>
    //webassembly使用
    var Module = {};
    var __cargo_web = {};
    Object.defineProperty( Module, 'canvas', {
        get: function() {
            if( __cargo_web.canvas ) {
                return __cargo_web.canvas;
            }

            var canvas = document.createElement( 'canvas' );
            document.querySelector( 'body' ).appendChild( canvas );
            __cargo_web.canvas = canvas;

            return canvas;
        }
    });

    function support_webassembly(){
        try {
            if (typeof WebAssembly === "object"
                && typeof WebAssembly.instantiate === "function") {
                const module = new WebAssembly.Module(Uint8Array.of(0x0, 0x61, 0x73, 0x6d, 0x01, 0x00, 0x00, 0x00));
                if (module instanceof WebAssembly.Module)
                    return new WebAssembly.Instance(module) instanceof WebAssembly.Instance;
            }
        } catch (e) {
        }
        return false;
    }

    function append_js(filename){
        var js = document.createElement("script");
        js.type = "text/javascript";
        js.src = filename;
        document.body.appendChild(js);
    }

    var is_QQInnerBro = function(){
        if (navigator.userAgent.match(/QQ\//i) == "QQ/") {
            return true;
        } else {
            return false;
        }
    };

    var useasmjs = is_QQInnerBro() && navigator.userAgent.indexOf("iPhone")>-1;

    if(!support_webassembly() || useasmjs){
        //不支持Webassembly
        append_js("client-asm.js");
    }else{
        append_js("client.js");
    }
</script>
</body>
</html>
